{% extends "base.html"%}

{% load static %}

{% block content %}
<h3>Co2</h3>
<div id="placeholder_co2" class="demo-placeholder" style="width: 100%; height:400px;"></div>

<h3>Moist</h3>
<div id="placeholder_moist" class="demo-placeholder" style="width: 100%; height:400px;"></div>

<h3>Lux</h3>
<div id="placeholder_lux" class="demo-placeholder" style="width: 100%; height:400px;"></div>

<h3>Temperature</h3>
<div id="placeholder_temp" class="demo-placeholder" style="width: 100%; height:400px;"></div>

<h3>Decibel</h3>
<div id="placeholder_db" class="demo-placeholder" style="width: 100%; height:400px;"></div>

<table class="table table-zebra table-bordered" id="data_list">
    <thead>
        <tr>
            <th data-col="datetime">Timestamp</th>
            <th data-col="temp">Temp</th>
            <th data-col="co2">Co2</th>
            <th data-col="db">DB</th>
            <th data-col="lux">LUX</th>
            <th data-col="movement">Movement</th>
            <th data-col="moist">Moist</th>
        </tr>
    </thead>
    <tbody>
    </tbody>
</table>
{% endblock %}

{% block javascript %}
<script language="javascript" type="text/javascript" src="{% static 'js/flot/jquery.flot.js' %}"></script>
<script language="javascript" type="text/javascript" src="{% static 'js/flot/jquery.flot.time.js' %}"></script>
<script type="text/javascript">
$(function() {
    function updateList() {
        var $list = $('#data_list');
        $.ajax({
            url: "{% url 'dashboard_room_state' room_id 20 %}",
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                $list.find('.record').remove();
            
                $.each(data, function(k, v) {
                    rowHtml = '<tr class="record">';
                    $list.find('th').each(function() {
                        col = $(this).attr('data-col');
                        rowHtml += '<td>' + v[col] + '</td>';
                    });
                    rowHtml += '</tr>';
                    $list.append(rowHtml);
                });
            }
        });
        setTimeout(updateList, 5000);
    }
    updateList();

    function updateGraph() {
        $.ajax({
            url: "{% url 'dashboard_room_state_for_graph' room_id %}",
            type: 'GET',
            dataType: 'json',
            success: function(series) {
                var flot_options = {
                    xaxis: {
                        mode: 'time'    
                    }
                }

                for (k in series) {
                    if (series.hasOwnProperty(k)) {
                        $.plot('#placeholder_' + k, [series[k]], flot_options);
                    }
                }
            }
        });
        setTimeout(updateGraph, 5000);
    };
    updateGraph();
});

</script>
{% endblock %}
